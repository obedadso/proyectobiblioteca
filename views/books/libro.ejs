<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Libros</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background: url('https://images.unsplash.com/photo-1519682337058-a94d519337bc') no-repeat center center fixed;
      background-size: cover;
      color: white;
    }
    .card {
      background-color: rgba(0, 0, 0, 0.75);
      color: white;
    }
    .card-header {
      background-color: rgba(255, 255, 255, 0.9);
    }
    .btn-add-custom {
      background: linear-gradient(45deg, #007bff, #6610f2);
      color: white;
      border: none;
      padding: 8px 20px;
      font-weight: bold;
      border-radius: 30px;
      transition: 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-add-custom.btn-sm {
      padding: 8px 22px;
      font-size: 0.8rem;
    }
    .btn-add-custom:hover {
      background: linear-gradient(45deg, #6610f2, #007bff);
      color: #fff;
      text-decoration: none;
    }
    .sidebar {
      background-color: rgba(0, 0, 0, 0.8);
      min-height: 100vh;
    }
    .avatar-small {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 50%;
      display: inline-block;
    }
    .nav-link {
      color: #fff;
    }
    .nav-link:hover {
      color: #ffc107;
    }
    .modal-content {
      background-color: #1c1c1c;
      color: white;
    }
    .modal-header, .modal-footer {
      border-color: #333;
    }
    .form-control, .form-select {
      background-color: #2b2b2b;
      color: white;
      border: 1px solid #555;
      border-radius: 10px;
    }
    .form-control:focus, .form-select:focus {
      background-color: #2b2b2b;
      color: white;
      border-color: #777;
      box-shadow: none;
    }
    label {
      color: #ccc;
    }
    .table th, .table td {
      color: #fff;
    }
    .pagination {
      display: flex;
      justify-content: center;
      padding: 20px 0;
    }
    .pagination a {
      color: #007bff;
      padding: 5px 10px;
      text-decoration: none;
    }
    .pagination a:hover {
      background-color: #007bff;
      color: white;
    }
    .pagination .active {
      background-color: #007bff;
      color: white;
      font-weight: bold;
      border: none;
    }
    footer {
      background-color: rgba(0, 0, 0, 0.8);
    }

    .pagination .page-link {
  background-color: #222 !important;
  color: #fff !important;
  border: 1px solid #444 !important;
  transition: background 0.2s, color 0.2s;
}
.pagination .page-link.bg-primary {
  background: linear-gradient(45deg, #007bff, #6610f2) !important;
  color: #fff !important;
  border: 1px solid #007bff !important;
}
.pagination .page-link:hover, .pagination .page-item.active .page-link {
  background: linear-gradient(45deg, #6610f2, #007bff) !important;
  color: #fff !important;
}
.pagination .page-item.disabled .page-link {
  background-color: #222 !important;
  color: #888 !important;
  border: 1px solid #444 !important;
}
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark w-100" style="margin-bottom: 0; border-radius: 0;">
    <a class="navbar-brand d-flex align-items-center" href="/">
      <span class="font-weight-bold">üìö Mi Biblioteca</span>
    </a>
  </nav>

  <div class="d-flex" style="min-height: 100vh;">
    <!-- Sidebar -->
    <div class="sidebar p-3 text-white" style="width: 250px;">
      <div class="text-center mb-4">
        <img src="/images/obed.png" alt="Usuario hombre" class="avatar-small mb-2" />
        <h6>Obed Alvarez</h6>
        <small class="text-success">‚óè En l√≠nea</small>
      </div>
      <ul class="nav flex-column">
        <li class="nav-item mb-2"><a class="nav-link" href="/">üìä Dashboard</a></li>
        <li class="nav-item mb-2"><a class="nav-link" href="/books/autores">üñã Autores</a></li>
        <li class="nav-item"><a class="nav-link" href="/books/editoriales">üè¢ Editoriales</a></li>
        <li class="nav-item"><a class="nav-link" href="/books/categorias">üìÇ Categorias</a></li>
        <li class="nav-item"><a class="nav-link active" href="/books">üìñ Libros</a></li>
      </ul>
    </div>

    <!-- Contenido principal -->
    <div class="container mt-4">
      <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
          <span class="text-dark w-100 text-center" style="font-weight:bold; font-size:1.5rem;">Gestion de Libros</span>
          <button class="btn btn-add-custom" data-bs-toggle="modal" data-bs-target="#modalAgregarLibro">
            <i class="bi bi-plus-circle"></i> Agregar Libro
          </button>
        </div>
        <!-- Barra de b√∫squeda -->
        <form class="my-3" method="get" action="/books">
          <div class="input-group" style="max-width: 400px; margin: 0 auto;">
            <input type="text" class="form-control bg-dark text-white border-secondary" name="busqueda" placeholder="Buscar por t√≠tulo, autor, ISBN..." value="<%= typeof busqueda !== 'undefined' ? busqueda : '' %>">
            <button class="btn btn-primary" type="submit"><i class="bi bi-search"></i> Buscar</button>
          </div>
        </form>
        <div class="card-body">
          <!-- Tabla de libros -->
          <table class="table table-bordered table-hover table-dark">
            <thead class="table-light text-dark">
              <tr>
                <th class="text-dark">#</th>
                <th class="text-dark">ISBN</th>
                <th class="text-dark">T√≠tulo</th>
                <th class="text-dark">Autor</th>
                <th class="text-dark">Editorial</th>
                <th class="text-dark">A√±o</th>
                <th class="text-dark">N√∫m. P√°ginas</th>
                <th class="text-dark">Categor√≠a</th>
                <th class="text-dark">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <% if (libros && libros.length > 0) { %>
                <% libros.forEach((libro, i) => { %>
                  <tr>
                    <td><%= (paginaActual ? (paginaActual - 1) * librosPorPagina : 0) + i + 1 %></td>
                    <td><%= libro.isbn %></td>
                    <td><%= libro.name %></td>
                    <td><%= libro.autor_nombre %></td>
                    <td><%= libro.editorial_nombre %></td>
                    <td><%= libro.anio_publicacion %></td>
                    <td><%= libro.num_paginas %></td>
                    <td><%= libro.categoria_nombre %></td>
                    <td>
                      <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalEditarLibro"
                        data-id="<%= libro.id %>"
                        data-isbn="<%= libro.isbn %>"
                        data-name="<%= libro.name %>"
                        data-author="<%= libro.author_id %>"
                        data-editorial="<%= libro.editorial_id %>"
                        data-anio="<%= libro.anio_publicacion %>"
                        data-paginas="<%= libro.num_paginas %>"
                        data-categoria="<%= libro.categoria_id %>">
                        ‚úèÔ∏è Editar
                      </button>
                      <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#modalEliminarLibro"
                        data-id="<%= libro.id %>" data-name="<%= libro.name %>">
                        üóëÔ∏è Eliminar
                      </button>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr><td colspan="9" class="text-center">No hay libros registrados.</td></tr>
              <% } %>
            </tbody>
          </table>

                   <!-- Paginaci√≥n -->
          <nav aria-label="Paginaci√≥n de libros">
            <ul class="pagination justify-content-center" style="--bs-pagination-bg: transparent;">
              <% if (paginaActual > 1) { %>
                <li class="page-item">
                  <a class="page-link bg-dark text-white border-secondary" style="border-radius: 20px 0 0 20px;" href="?pagina=<%= paginaActual - 1 %>">
                    <i class="bi bi-chevron-left"></i> Anterior
                  </a>
                </li>
              <% } else { %>
                <li class="page-item disabled">
                  <span class="page-link bg-dark text-secondary border-secondary" style="border-radius: 20px 0 0 20px;">
                    <i class="bi bi-chevron-left"></i> Anterior
                  </span>
                </li>
              <% } %>
              <% for (let i = 1; i <= totalPaginas; i++) { %>
                <li class="page-item <%= paginaActual === i ? 'active' : '' %>">
                  <a class="page-link <%= paginaActual === i ? 'bg-primary text-white' : 'bg-dark text-white' %> border-secondary" 
                     style="margin: 0 2px; border-radius: 10px;"
                     href="?pagina=<%= i %>"><%= i %></a>
                </li>
              <% } %>
              <% if (paginaActual < totalPaginas) { %>
                <li class="page-item">
                  <a class="page-link bg-dark text-white border-secondary" style="border-radius: 0 20px 20px 0;" href="?pagina=<%= paginaActual + 1 %>">
                    Siguiente <i class="bi bi-chevron-right"></i>
                  </a>
                </li>
              <% } else { %>
                <li class="page-item disabled">
                  <span class="page-link bg-dark text-secondary border-secondary" style="border-radius: 0 20px 20px 0;">
                    Siguiente <i class="bi bi-chevron-right"></i>
                  </span>
                </li>
              <% } %>
            </ul>
          </nav>

  <!-- Modal Agregar Libro -->
  <div class="modal fade" id="modalAgregarLibro" tabindex="-1">
    <div class="modal-dialog">
      <form class="modal-content" action="/books/add" method="POST">
        <div class="modal-header">
          <h5 class="modal-title">Agregar Libro</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3"><label>ISBN:</label><input type="text" class="form-control" name="isbn" required></div>
          <div class="mb-3"><label>T√≠tulo:</label><input type="text" class="form-control" name="name" required></div>
          <div class="mb-3">
            <label>Autor:</label>
            <select class="form-select" name="author" required>
              <option value="">Seleccione un autor</option>
              <% autores.forEach(a => { %>
                <option value="<%= a.id %>"><%= a.nombre %></option>
              <% }) %>
            </select>
          </div>
          <div class="mb-3">
            <label>Editorial:</label>
            <select class="form-select" name="editorial" required>
              <option value="">Seleccione una editorial</option>
              <% editoriales.forEach(e => { %>
                <option value="<%= e.id %>"><%= e.name %></option>
              <% }) %>
            </select>
          </div>
          <div class="mb-3"><label>A√±o de Publicaci√≥n:</label><input type="number" class="form-control" name="anio_publicacion" required></div>
          <div class="mb-3"><label>N√∫m. de P√°ginas:</label><input type="number" class="form-control" name="num_paginas" required></div>
          <div class="mb-3">
            <label>Categor√≠a:</label>
            <select class="form-select" name="categoria" required>
              <option value="">Seleccione una categor√≠a</option>
              <% categorias.forEach(c => { %>
                <option value="<%= c.id %>"><%= c.nombre %></option>
              <% }) %>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Registrar</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Editar Libro -->
  <div class="modal fade" id="modalEditarLibro" tabindex="-1">
    <div class="modal-dialog">
      <form class="modal-content" id="formEditarLibro" method="POST">
        <div class="modal-header">
          <h5 class="modal-title">Editar Libro</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3"><label>ISBN:</label><input type="text" class="form-control" name="isbn" id="edit-isbn" required></div>
          <div class="mb-3"><label>T√≠tulo:</label><input type="text" class="form-control" name="name" id="edit-name" required></div>
          <div class="mb-3">
            <label>Autor:</label>
            <select class="form-select" name="author" id="edit-author" required>
              <option value="">Seleccione un autor</option>
              <% autores.forEach(a => { %>
                <option value="<%= a.id %>"><%= a.nombre %></option>
              <% }) %>
            </select>
          </div>
          <div class="mb-3">
            <label>Editorial:</label>
            <select class="form-select" name="editorial" id="edit-editorial" required>
              <option value="">Seleccione una editorial</option>
              <% editoriales.forEach(e => { %>
                <option value="<%= e.id %>"><%= e.name %></option>
              <% }) %>
            </select>
          </div>
          <div class="mb-3"><label>A√±o de Publicaci√≥n:</label><input type="number" class="form-control" name="anio_publicacion" id="edit-anio" required></div>
          <div class="mb-3"><label>N√∫m. de P√°ginas:</label><input type="number" class="form-control" name="num_paginas" id="edit-paginas" required></div>
          <div class="mb-3">
            <label>Categor√≠a:</label>
            <select class="form-select" name="categoria" id="edit-categoria" required>
              <option value="">Seleccione una categor√≠a</option>
              <% categorias.forEach(c => { %>
                <option value="<%= c.id %>"><%= c.nombre %></option>
              <% }) %>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Actualizar</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Eliminar -->
  <div class="modal fade" id="modalEliminarLibro" tabindex="-1">
    <div class="modal-dialog">
      <form class="modal-content" id="formEliminarLibro" method="POST">
        <div class="modal-header">
          <h5 class="modal-title">Eliminar Libro</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>¬øSeguro que deseas eliminar el libro <strong id="deleteLibroName"></strong>?</p>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-danger">Eliminar</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Rellenar modal de editar libro
    var modalEditar = document.getElementById('modalEditarLibro');
    modalEditar.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget;
      var id = button.getAttribute('data-id');
      var isbn = button.getAttribute('data-isbn');
      var name = button.getAttribute('data-name');
      var author = button.getAttribute('data-author');
      var editorial = button.getAttribute('data-editorial');
      var anio = button.getAttribute('data-anio');
      var paginas = button.getAttribute('data-paginas');
      var categoria = button.getAttribute('data-categoria');

      var form = document.getElementById('formEditarLibro');
      form.action = '/books/update/' + id;
      form.querySelector('#edit-isbn').value = isbn;
      form.querySelector('#edit-name').value = name;
      form.querySelector('#edit-author').value = author;
      form.querySelector('#edit-editorial').value = editorial;
      form.querySelector('#edit-anio').value = anio;
      form.querySelector('#edit-paginas').value = paginas;
      form.querySelector('#edit-categoria').value = categoria;
    });

    // Rellenar modal de eliminar libro
    var modalEliminar = document.getElementById('modalEliminarLibro');
    modalEliminar.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget;
      var id = button.getAttribute('data-id');
      var name = button.getAttribute('data-name');
      document.getElementById('deleteLibroName').textContent = name;
      var form = document.getElementById('formEliminarLibro');
      form.action = '/books/delete/' + id;
      form.method = 'POST';
    });
  </script>
  <footer class="text-white text-center py-3 mt-auto w-100">
    &copy; 2025 Mi Biblioteca. Todos los derechos reservados.
    <span class="float-right mr-4">Versi√≥n 1.0</span>
  </footer>
</body>
</html>